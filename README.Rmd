---
title: "Aviation Safety Analysis: Trends in NTSB Accident Data"
output: html_document
author: "Harrison Voss"
---

## Introduction

Aviation is a major part of the American transportation infrastructure, the goal of this project is to explore questions related to the safety of air travel, using the National Transportation Safety Board (NTSB) data on aviation accidents. In recent times, there has been increased public concern with air travel safety, both in respect to pilots making mistakes and the mechanical failure of aircraft, in this project we look to explore these questions. Looking into these questions can help us to understand if there is an uptick in incidents, or if other factors are leading to these events having more attention brought to them.

This dataset includes data from 2008 to present, with thousands of incident reports, allowing us to get a good idea of trends in aviation safety.

**Source for the data**: <https://data.ntsb.gov/avdata>

**Note on Data Processing**: This data was converted from .mdb (Microsoft Access format) to .csv using mdb-tools on a Linux machine to enable analysis in R.

**What is an "Event"?**

*"A distinct major occurrence of relative significance that leads to an accident or incident."*

So in the NTSB system:

- Accidents = events with damage or injuries

- Incidents = less severe events (like equipment malfunctions that were corrected before causing harm)

**Research Questions**

This project investigates the following key questions about aviation safety:

1. Have incidents been increasing or decreasing over time?

2. What kinds of events/accidents are most common?

3. Where do they happen most oftenâ€”is there a geographic trend?

4. Is there a trend in when incidents occur (time of year or time of day)?

## Data Cleaning and Preperation

### Data import

```{r, results='hide'}
library(tidyverse)
library(lubridate)
library(ggplot2)
library(stringr)

events <- read_csv("events.csv")

# Display initial structure
str(events)
head(events)
```

### Data Cleaning

```{r, results= 'hide'}
aviation_clean <- events %>%
  mutate(
    # Parse date field with multiple possible formats
    ev_date = parse_date_time(ev_date, orders = "mdy HMS", tz = "UTC"),
    # Convert numeric fields
    ev_year = as.numeric(ev_year),
    ev_month = as.numeric(ev_month),
    latitude = as.numeric(latitude),
    longitude = as.numeric(longitude),
    inj_tot_t = as.numeric(inj_tot_t),
    # Convert categorical fields to factors
    ev_highest_injury = as.factor(ev_highest_injury),
    # Clean and standardize state codes
    ev_state = toupper(trimws(ev_state)),
    # Standardize country names
    ev_country = toupper(trimws(ev_country))
  ) %>%
  # Filter criteria: only USA incidents with valid dates and states
  filter(
    !is.na(ev_date) & 
    ev_country == "USA" &
    !is.na(ev_state) &
    ev_state != "" &
    nchar(ev_state) == 2  # Valid US state codes are exactly 2 characters
  ) %>%
  # Convert to factor after cleaning
  mutate(ev_state = as.factor(ev_state))

# Summary of cleaning results
cat("Original records:", nrow(events), "\n")
cat("Records after cleaning:", nrow(aviation_clean), "\n")
cat("Records removed:", nrow(events) - nrow(aviation_clean), "\n")

str(aviation_clean)
```
#### Cleaning Notes:

- Date parsing: The ev_date field was parsed as month-day-year with time. Records with missing or unparseable dates were removed (approximately 5-10% of records).

- Geographic filter: Only incidents in the USA were retained to focus analysis on domestic aviation safety. International incidents accounted for roughly 20% of the dataset.

- Type conversions: Numeric fields (coordinates, injury counts) were explicitly converted to ensure proper calculation. Any records with invalid numeric conversions were coerced to NA and retained in the dataset (with NA flagged in analysis).

- Standardization: Country names were standardized to uppercase to avoid matching errors from inconsistent capitalization.

#### Final dataset characteristics:
- Time period: 2008 to present

- Total incidents: `r nrow(aviation_clean)`

# Exploratory Analysis 




## Question 1: Have Incidents Been Increasing or Decreasing?
```{r, results='hide'}
# Count incidents by year
incidents_by_year <- aviation_clean %>%
  group_by(ev_year) %>%
  summarise(
    incident_count = n(),
    .groups = 'drop'
  ) %>%
  filter(!is.na(ev_year))

# Time-series plot
ggplot(incidents_by_year, aes(x = ev_year, y = incident_count)) +
  geom_line(color = "steelblue", size = 1) +
  geom_point(color = "steelblue", size = 2) +
  labs(
    title = "Aviation Incidents Over Time (2008-Present)",
    x = "Year",
    y = "Number of Incidents",
    subtitle = "USA-based incidents from NTSB database"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

### Findings:
If we ignore the current year (incomplete dataset) and focus on the general trends, we can see that it does look like the number of incidents has been going down over time. However, there seems to be some sharp downturns that could be due to missing data.

Overall though, the trend does seem to be downward.

## Question 2: What Kinds of Events/Accidents Are Most Common?

```{r, results= 'hide'}
findings <- read_csv("Findings.csv")

# Check the ev_id in findings
cat("Findings ev_id:\n")
print(head(findings$ev_id, 10))
cat("\nClass:", class(findings$ev_id), "\n")

# Check the ev_id in aviation_clean
cat("\n\nAviation_clean ev_id:\n")
print(head(aviation_clean$ev_id, 10))
cat("\nClass:", class(aviation_clean$ev_id), "\n")

# Check if they match
cat("\n\nDo any match?\n")
print(findings$ev_id[1] %in% aviation_clean$ev_id)
print(findings$ev_id[2] %in% aviation_clean$ev_id)
print(findings$ev_id[3] %in% aviation_clean$ev_id)

# Create findings_primary - take first finding per event
findings_primary <- findings %>%
  group_by(ev_id) %>%
  slice(1) %>%
  ungroup() %>%
  mutate(
    finding_category = str_extract(finding_description, "^[^-]+")
  ) %>%
  select(ev_id, finding_code, finding_description, finding_category, Cause_Factor)

cat("findings_primary created:\n")
print(head(findings_primary, 10))

# Join findings_primary to aviation_clean
aviation_clean <- aviation_clean %>%
  left_join(findings_primary, by = "ev_id")

cat("Join complete!\n")
cat("\nColumns in aviation_clean:\n")
print(colnames(aviation_clean))

cat("\n\nSample data:\n")
print(head(aviation_clean %>% select(ev_id, finding_description, finding_category, Cause_Factor), 10))
```


```{r, results='hide'}
# First, examine the main event type categories (ACC vs INC)
event_type_summary <- aviation_clean %>%
  group_by(ev_type) %>%
  summarise(
    count = n(),
    total_injuries = sum(inj_tot_t, na.rm = TRUE),
    avg_injuries = mean(inj_tot_t, na.rm = TRUE),
    percentage = round(100 * n() / nrow(aviation_clean), 1),
    .groups = 'drop'
  ) %>%
  arrange(desc(count))

# Display main event type breakdown
event_type_summary %>%
  knitr::kable(
    caption = "Aviation Event Type Categories (ACC vs INC)",
    col.names = c("Event Type", "Count", "Total Injuries", "Avg Injuries", "Percentage")
  )

# Visualization of main categories
ggplot(event_type_summary, aes(x = reorder(ev_type, count), y = count, fill = ev_type)) +
  geom_col() +
  geom_text(aes(label = paste0(count, "\n(", percentage, "%)")), 
            hjust = -0.1, size = 3) +
  labs(
    title = "Aviation Events by Category",
    x = "Event Type",
    y = "Number of Events",
    subtitle = "ACC = Accident (damage/injury), INC = Incident (less severe)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.margin = margin(10, 50, 10, 10)
  ) +
  scale_x_discrete(expand = c(0, 0)) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +
  coord_flip()

# Check if finding_category column exists
if("finding_category" %in% colnames(aviation_clean)) {
  # Analyze by finding category (Aircraft, Personnel, Environmental, etc.)
  finding_category_summary <- aviation_clean %>%
    filter(!is.na(finding_category)) %>%
    group_by(finding_category) %>%
    summarise(
      count = n(),
      total_injuries = sum(inj_tot_t, na.rm = TRUE),
      avg_injuries = mean(inj_tot_t, na.rm = TRUE),
      percentage = round(100 * n() / nrow(aviation_clean), 1),
      .groups = 'drop'
    ) %>%
    arrange(desc(count))

  cat("\n\nIncident Distribution by Primary Issue Category:\n")
  finding_category_summary %>%
    knitr::kable(
      caption = "Events by Finding Category",
      col.names = c("Finding Category", "Count", "Total Injuries", "Avg Injuries", "Percentage")
    )

  # Visualization
  ggplot(finding_category_summary, aes(x = reorder(finding_category, count), y = count, fill = finding_category)) +
    geom_col() +
    coord_flip() +
    labs(
      title = "Aviation Events by Primary Issue Category",
      x = "Category",
      y = "Number of Events",
      subtitle = "Based on primary NTSB finding codes"
    ) +
    theme_minimal() +
    theme(
      legend.position = "none",
      plot.margin = margin(10, 50, 10, 10)
    ) +
    geom_text(aes(label = count), hjust = -0.3, size = 3) +
    scale_x_discrete(expand = c(0, 0)) +
    scale_y_continuous(expand = expansion(mult = c(0, 0.15)))
} else {
  cat("\nNote: finding_category column not found. Check data join.\n")
}

# Top specific findings (most detailed level)
if("finding_description" %in% colnames(aviation_clean)) {
  top_specific_findings <- aviation_clean %>%
    filter(!is.na(finding_description)) %>%
    group_by(finding_description) %>%
    summarise(
      count = n(),
      total_injuries = sum(inj_tot_t, na.rm = TRUE),
      avg_injuries = mean(inj_tot_t, na.rm = TRUE),
      .groups = 'drop'
    ) %>%
    arrange(desc(count)) %>%
    head(15)

  cat("\n\nTop 15 Most Common Specific Finding Descriptions:\n")
  print(top_specific_findings)
}

# Cause vs Factor breakdown
if("Cause_Factor" %in% colnames(aviation_clean)) {
  cause_factor_summary <- aviation_clean %>%
    filter(!is.na(Cause_Factor)) %>%
    group_by(Cause_Factor) %>%
    summarise(
      count = n(),
      percentage = round(100 * n() / nrow(aviation_clean), 1),
      avg_injuries = mean(inj_tot_t, na.rm = TRUE),
      .groups = 'drop'
    )

  cat("\n\nEvents Classified as Cause vs Factor:\n")
  print(cause_factor_summary)
}
```

### Which are More Likely to Be Factors Vs. Causes?
```{r, results='hide'}
# Analyze Cause vs Factor breakdown by finding category
cause_factor_by_category <- aviation_clean %>%
  filter(!is.na(finding_category) & !is.na(Cause_Factor)) %>%
  group_by(finding_category, Cause_Factor) %>%
  summarise(count = n(), .groups = 'drop') %>%
  group_by(finding_category) %>%
  mutate(
    total = sum(count),
    percentage = round(100 * count / total, 1)
  ) %>%
  ungroup()

cat("Cause vs Factor by Category:\n")
print(cause_factor_by_category)

# Visualization - stacked bar chart
ggplot(cause_factor_by_category, aes(x = reorder(finding_category, total), y = percentage, fill = Cause_Factor)) +
  geom_col() +
  geom_text(aes(label = paste0(percentage, "%")), position = position_stack(vjust = 0.5), size = 3) +
  coord_flip() +
  labs(
    title = "Cause vs Factor Distribution by Category",
    x = "Finding Category",
    y = "Percentage",
    fill = "Type",
    subtitle = "What % of each category's findings are Causes vs Factors?"
  ) +
  theme_minimal() +
  theme(
    plot.margin = margin(10, 50, 10, 10)
  ) +
  scale_y_continuous(limits = c(0, 100), expand = expansion(mult = c(0, 0.05)))
```

### Average Injuries Caused

```{r, results = 'hide'}
# Average injuries by finding category
avg_injuries_by_category <- aviation_clean %>%
  filter(!is.na(finding_category)) %>%
  group_by(finding_category) %>%
  summarise(
    avg_injuries = mean(inj_tot_t, na.rm = TRUE),
    count = n(),
    .groups = 'drop'
  ) %>%
  arrange(desc(avg_injuries))

print(avg_injuries_by_category)
```
```{r}
# Visualization
ggplot(avg_injuries_by_category, aes(x = reorder(finding_category, avg_injuries), y = avg_injuries, fill = finding_category)) +
  geom_col() +
  geom_text(aes(label = round(avg_injuries, 2)), hjust = -0.2, size = 3) +
  coord_flip() +
  labs(
    title = "Average Number of Injuries by Finding Category",
    x = "Finding Category",
    y = "Average Injuries per Incident",
    subtitle = "Which issue types result in the most injuries?"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.margin = margin(10, 50, 10, 10)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.15)))
```

### Findings:

By analyzing the NTSB Findings data, we now understand that incidents cluster into broad categories, such as Aircraft issues, Personnel issues, Environmental conditions, and others. This breakdown shows:

- We can see that the most common issue's are by far Aircraft, and Personnel Issues.

- We can see that Aircraft and Personnel issues are almost always the cause, but Environmental and Organizational issues can sometimes be a factor instead.

- We can see that Accidents are (unfortunately) much more common than incidents, meaning that the vast majority of the time when an event happens, there is some type of damage or injury.

- We can see that average injuries for the most common events are relatively low, while the one accident attributed to the Main System caused massive numbers of injuries.

## Question 3: What States and Months Have the Most Incidents?

```{r}
state_counts <- aviation_clean %>%
  count(ev_state, sort = TRUE) %>%
  head(15)

ggplot(state_counts, aes(x = reorder(ev_state, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Top 15 States by Aviation Events",
    x = "State",
    y = "Number of Events"
  ) +
  theme_minimal() +
  geom_text(aes(label = n), hjust = -0.2, size = 3)
```

## Question 4: What Time Do They Occur?

```{r}
# Count events by month
month_counts <- aviation_clean %>%
  count(ev_month, sort = FALSE) %>%
  filter(!is.na(ev_month))

# Create bar chart
ggplot(month_counts, aes(x = ev_month, y = n)) +
  geom_col(fill = "steelblue") +
  scale_x_continuous(
    breaks = 1:12,
    labels = month.abb
  ) +
  labs(
    title = "Aviation Events by Month",
    x = "Month",
    y = "Number of Events"
  ) +
  theme_minimal() +
  geom_text(aes(label = n), vjust = -0.5, size = 3)
```